#!/bin/sh

pos_dirs=`find . -name configure.ac | sed -e s%/configure.ac%%g`
dirs=
for dir in $pos_dirs; do
  if test -r $dir/configure.ac; then
    dirs="$dirs $dir"
  fi
done
echo Running autotools in $dirs

currdir=`pwd`
if test -r $currdir/BuildTools/coin.m4; then
  toolsdir=$currdir/BuildTools
else
  if test -r $currdir/../BuildTools/coin.m4; then
    toolsdir=$currdir/../BuildTools
  else
    echo Cannot find BuildTools directory.
    exit 1
  fi
fi

for dir in $dirs; do
  (cd $dir
   echo creating acinclude.m4 in $dir
   cat $HOME/share/aclocal/libtool.m4 $toolsdir/coin.m4> acinclude.m4
   echo running aclocal in $dir
   aclocal
   if grep AC_CONFIG_HEADER configure.ac >/dev/null 2>&1; then
     echo running autoheader in $dir
     autoheader
   fi
   echo running automake in $dir
   automake
   echo running autoconf in $dir
   autoconf
   )
done
